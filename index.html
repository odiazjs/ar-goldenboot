<!DOCTYPE html>
<html>

<head>
  <title>
    Barcelona AR Experience
  </title>

  <style>
  </style>

  <meta name="description" content="balondioro">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">

  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="/css/all.min.css">
  <link rel="stylesheet" href="/css/flexboxgrid.min.css">
  <link rel="stylesheet" type="text/css" href="/css/animate.css">
  <link rel="stylesheet" type="text/css" href="/css/styles.css">

  <script type="module" src="https://unpkg.com/@google/model-viewer@0.3.1/dist/model-viewer.js">
  </script>

  <script nomodule src="https://unpkg.com/@google/model-viewer@0.3.1/dist/model-viewer-legacy.js">
  </script>

  <script src="https://aframe.io/releases/1.0.3/aframe.min.js"></script>
  <script src="./js/hammer.js"></script>
  <script src="/aframe.js"></script>
  <script src="/script.js"></script>
  <script src="/js/app.js"></script>
  <script src="/js/media.js"></script>

  <script>

    let markerFound = false;
    let loader = null;
    const markersMedia = {
      'a-marker-0': { vidSrc: '#oro-intro' },
      'a-marker-1': { vidSrc: '#iniesta-gol' }
    };

    AFRAME.registerComponent('registerevents', {
      init: function () {
        var marker = this.el;

        // Make the element emit events when found and when lost.
        marker.setAttribute('emitevents', 'true');

        marker.addEventListener('markerFound', function () {
          var markerId = marker.id;
          markerFound = true;
          console.log('markerFound', markerId);
          const videoEl = document.getElementById("a-video");
          videoEl.setAttribute('src', markersMedia[markerId].vidSrc);
        });

        marker.addEventListener('markerLost', function () {
          var markerId = marker.id;
          markerFound = false;
          pauseMedia();
          console.log('markerLost', markerId);
        });
      }
    });
    AFRAME.registerComponent('modelonload', {
      init: function () {
        loader = document.querySelector("#spinner");
        this.el.addEventListener('model-loaded', e => {
          console.log('loaded !!!!!!! ');
          if (markerFound) {
            setTimeout(() => {
              playMedia();
            }, 500)
          }
        })
      },
      tick: function () {
        if (markerFound && loader) {
          setTimeout(() => {
            loader.style.display = "none";
          }, 5);
        } else {
          setTimeout(() => {
            loader.style.display = "";
          }, 5);
        }
      }
    });

    // Media
    const playMedia = () => {
      var v = document.querySelector('#oro-intro');
      var v2 = document.querySelector('#iniesta-gol');
      v.play();
      v2.play();
    }
    const pauseMedia = () => {
      var v = document.querySelector('#oro-intro');
      var v2 = document.querySelector('#iniesta-gol');
      v.pause();
      v2.pause();
    }
    window.addEventListener('click', function () {
      playMedia();
    });

  </script>

</head>

<body style='margin : 0px; overflow: hidden;'>

  <div id="spinner" class="loading">
    <div class="loader"></div>
  </div>

  <!-- FC Barcelona Brand Start -->
  <div class="header">
    <div class="row">
      <div class="col-xs-3">
        <img class="logo" src="./assets/fcblogo.png" alt="fcb logo" />
      </div>
      <div class="col-xs-9">
        <a href="#" class="title">BARCELONA AR EXPERIENCE</a>
      </div>
    </div>
  </div>

  <footer>
    <div class="row" style="">
      <div class="col-xs-6">
        <div class="row">
          <div class="col-xs-4">
            &nbsp;
          </div>
          <div class="col-xs-4">
            <i class="fas fa-lock" style="font-size: 1em;"></i>
            <img width="80" src="./assets/balon-oro-locked.png" alt="fcb logo" />
          </div>
          <div class="col-xs-4">
            &nbsp;
          </div>
        </div>
      </div>
      <div class="col-xs-6">
        <div class="row">
          <div class="col-xs-4">
            &nbsp;
          </div>
          <div class="col-xs-4">
            <i class="fas fa-lock" style="font-size: 1em;"></i>
            <img width="80" src="./assets/iniesta-boot-locked.png" alt="fcb logo" />
          </div>
          <div class="col-xs-4">
            &nbsp;
          </div>
        </div>
      </div>
    </div>
    <div class="row" style="">
      <div class="col-xs-6">
        <div class="row">
          <div class="col-xs-4">
            &nbsp;
          </div>
          <div class="col-xs-4">
            <i class="fas fa-lock" style="font-size: 1em;"></i>
            <img width="80" src="./assets/balon-oro-locked.png" alt="fcb logo" />
          </div>
          <div class="col-xs-4">
            &nbsp;
          </div>
        </div>
      </div>
      <div class="col-xs-6">
        <div class="row">
          <div class="col-xs-4">
            &nbsp;
          </div>
          <div class="col-xs-4">
            <i class="fas fa-lock" style="font-size: 1em;"></i>
            <img width="80" src="./assets/balon-oro-locked.png" alt="fcb logo" />
          </div>
          <div class="col-xs-4">
            &nbsp;
          </div>
        </div>
      </div>
    </div>
  </footer>

  <!-- FC Barcelona Brand End -->

  <a-scene embedded arjs='sourceType: webcam;'
    renderer="colorManagement: true; physicallyCorrectLights: true; logarithmicDepthBuffer: true; sortObjects: false;">

    <a-assets>
      <a-entity src="/assets/botin-oro/Botin de Oro.gltf" id="golden-boot"></a-entity>
      <a-entity src="/assets/iniesta/Zapato Iniesta.gltf" id="iniesta-boot"></a-entity>
      <video id="oro-intro" autoplay loop controls="true" crossorigin="anonymous" playsinline webkit-playsinline media
        muted="true" play="true" src="./assets/videos/botin-oro-messi-low-res.mp4?12345678910">
      </video>
      <video id="iniesta-gol" autoplay loop controls="true" crossorigin="anonymous" playsinline webkit-playsinline
        media2 muted="true" play="true" src="./assets/videos/Gol de Iniesta.mp4?12345678910">
      </video>
    </a-assets>

    <a-marker id="a-marker-0" listener interaction hammer registerevents emitevents="true" cursor="rayOrigin: mouse"
      type='pattern' url='./assets/markers/pattern-goldenboot.patt'>
    </a-marker>

    <a-entity id="target" gltf-model="#golden-boot" position="-0.14671 -1.37996 -8.10592" modelonload rotation="20 0 0"
      scale=".5 .5 .5" visible="">
    </a-entity>

    <a-video id="a-video" media media2 src="#oro-intro" width="16" height="9" position="0 5 -30" rotation="0 0 0"
      scale=".6 .6 .6">
    </a-video>

    <a-marker id="a-marker-1" listener2 interaction hammer2 registerevents emitevents="true" cursor="rayOrigin: mouse"
      type='pattern' url='./assets/markers/pattern-iniesta-marker.patt'>
    </a-marker>

    <a-entity id="target2" gltf-model="#iniesta-boot" position="-0.14671 -1.37996 -8.10592" modelonload
      rotation="20 0 0" scale=".5 .5 .5" visible="">
    </a-entity>

    <a-camera-static />

    <a-light id="spot-light" type="spot" color="white"
      light="type: point; color: #ffffff; intensity: 20; penumbra: 1; castShadow: true; shadowBias: 1"
      position="-0.09255 1.68958 -4.47987" rotation="">
    </a-light>

  </a-scene>

</body>

</html>